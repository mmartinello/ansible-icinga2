---
- name: Ensure custom conf.d directory is present
  file:
    path: "{{ config_root_dir }}/{{ custom_confd_dir }}"
    state: directory
  tags: ['install-icinga2-stack', 'config']

- name: Ensure config files are recursively included from conf.d dir
  lineinfile:
    path: "{{ main_config_file }}"
    line: "include_recursive \"{{ custom_confd_dir }}\""
    state: present
  tags: ['install-icinga2-stack', 'config']

- name: Ensure services.d directory is present
  file:
    path: "{{ config_root_dir }}/{{ services_dir }}"
    state: directory
  tags: ['install-icinga2-stack', 'config']
  
- name: Ensure config files are recursively included from services dir
  lineinfile:
    path: "{{ main_config_file }}"
    line: "include_recursive \"{{ services_dir }}\""
    state: present
  tags: ['install-icinga2-stack', 'config']

- name: Remove default services.conf file
  file:
    path: "{{ config_root_dir }}/{{ confd_dir }}/services.conf"
    state: absent
  tags: ['install-icinga2-stack', 'config']

- name: Reload Icinga2
  service:
    name: icinga2
    state: reloaded
  tags: ['install-icinga2-stack', 'config']
